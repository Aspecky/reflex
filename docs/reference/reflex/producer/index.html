<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/reflex/producer">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Producer | Reflex</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://littensy.github.io/reflex/img/social_card.png"><meta data-rh="true" name="twitter:image" content="https://littensy.github.io/reflex/img/social_card.png"><meta data-rh="true" property="og:url" content="https://littensy.github.io/reflex/docs/reference/reflex/producer"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Producer | Reflex"><meta data-rh="true" name="description" content="Manage your game&#x27;s state with producers."><meta data-rh="true" property="og:description" content="Manage your game&#x27;s state with producers."><link data-rh="true" rel="icon" href="/reflex/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://littensy.github.io/reflex/docs/reference/reflex/producer"><link data-rh="true" rel="alternate" href="https://littensy.github.io/reflex/docs/reference/reflex/producer" hreflang="en"><link data-rh="true" rel="alternate" href="https://littensy.github.io/reflex/docs/reference/reflex/producer" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RB6KJ1M85Y-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Reflex" href="/reflex/opensearch.xml"><link rel="stylesheet" href="/reflex/assets/css/styles.c0a3f341.css">
<link rel="preload" href="/reflex/assets/js/runtime~main.d382dee3.js" as="script">
<link rel="preload" href="/reflex/assets/js/main.edd3121e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_NAB0" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/reflex/"><div class="navbar__logo"><img src="/reflex/img/logo.svg" alt="Reflex Logo" class="themedImage_Zodd themedImage--light_OQxR"><img src="/reflex/img/logo.svg" alt="Reflex Logo" class="themedImage_Zodd themedImage--dark_HCKq"></div><b class="navbar__title text--truncate">Reflex</b></a><a class="navbar__item navbar__link" href="/reflex/docs/">Learn</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reflex/docs/reference/reflex/">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/littensy/reflex" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_HVLo colorModeToggle_MPlM"><button class="clean-btn toggleButton_WxxZ toggleButtonDisabled_kXev" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_HsUt"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Mqoj"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ypbp"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_jX_Q docsWrapper_BTzr"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_W55J" type="button"></button><div class="docPage_ecK0"><aside class="theme-doc-sidebar-container docSidebarContainer_QPD9"><div class="sidebarViewport_cDNc"><div class="sidebar_xx1V"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VvSw"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/reflex/docs/reference/reflex/">Reflex</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reflex&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reflex/docs/reference/reflex/create-producer">createProducer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/reflex/docs/reference/reflex/producer">Producer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reflex/docs/reference/reflex/combine-producers">combineProducers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reflex/docs/reference/reflex/create-selector">createSelector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reflex/docs/reference/reflex/middleware">Middleware</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reflex/docs/reference/reflex/create-broadcaster">createBroadcaster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reflex/docs/reference/reflex/create-broadcast-receiver">createBroadcastReceiver</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reflex/docs/reference/roact-reflex/">Roact Reflex</a><button aria-label="Toggle the collapsible sidebar category &#x27;Roact Reflex&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_YVPj"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_jO8Q"><div class="docItemContainer_MLiI"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xYkp" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/reflex/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_flTW"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/reflex/docs/reference/reflex/"><span itemprop="name">Reflex</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Producer</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_P4c9 theme-doc-toc-mobile tocMobile_tWXV"><button type="button" class="clean-btn tocCollapsibleButton_WWnv">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Producer</h1><p>A producer is a state container with built-in functions to update state and run side effects. To create one, use <a href="/reflex/docs/reference/reflex/create-producer"><code>createProducer</code></a>.</p><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> producer </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createProducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initialState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> actions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="tableOfContentsInline_lCiT"><ul class="table-of-contents"><li><a href="#reference">Reference</a><ul><li><a href="#action-functions"><code>action</code> functions</a></li><li><a href="#getstateselector"><code>getState(selector?)</code></a></li><li><a href="#setstatenewstate"><code>setState(newState)</code></a></li><li><a href="#resetstate"><code>resetState()</code></a></li><li><a href="#subscribeselector-predicate-listener"><code>subscribe(selector?, predicate?, listener)</code></a></li><li><a href="#onceselector-predicate-listener"><code>once(selector, predicate?, listener)</code></a></li><li><a href="#waitselector-predicate"><code>wait(selector, predicate?)</code></a></li><li><a href="#observeselector-discriminator-observer"><code>observe(selector, discriminator?, observer)</code></a></li><li><a href="#observewhileselector-predicate-observer"><code>observeWhile(selector, predicate?, observer)</code></a></li><li><a href="#flush"><code>flush()</code></a></li><li><a href="#applymiddlewaremiddlewares"><code>applyMiddleware(...middlewares)</code></a></li></ul></li><li><a href="#usage">Usage</a><ul><li><a href="#running-side-effects">Running side effects</a></li><li><a href="#waiting-for-state-changes">Waiting for state changes</a></li><li><a href="#transforming-state-with-selectors">Transforming state with selectors</a></li><li><a href="#using-the-observer-pattern">Using the observer pattern</a></li><li><a href="#using-middleware">Using middleware</a></li><li><a href="#using-multiple-producers">Using multiple producers</a></li></ul></li></ul></div><hr><h2 class="anchor anchorWithStickyNavbar_jD0q" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2><h3 class="anchor anchorWithStickyNavbar_jD0q" id="action-functions"><code>action</code> functions<a href="#action-functions" class="hash-link" aria-label="Direct link to action-functions" title="Direct link to action-functions">​</a></h3><p>Actions are functions that update the producer&#x27;s state. They are created by passing an object of action functions to <a href="/reflex/docs/reference/reflex/create-producer"><code>createProducer</code></a>.</p><p>You can dispatch an action by calling it on the producer:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> producer </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createProducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#8250DF">increment</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state </span><span class="token operator" style="color:#D73A49">+</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">// 1</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> producer </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Reflex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">createProducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    increment </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state </span><span class="token operator" style="color:#D73A49">+</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">--&gt; 1</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><a href="/reflex/docs/reference/reflex/create-producer#updating-state-with-actions">See how to create actions here.</a></p><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters">Parameters<a href="#parameters" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><code>...args</code> - The parameters to pass to the action function.</li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns">Returns<a href="#returns" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p>Dispatching returns the new state of the producer.</p><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="getstateselector"><code>getState(selector?)</code><a href="#getstateselector" class="hash-link" aria-label="Direct link to getstateselector" title="Direct link to getstateselector">​</a></h3><p>Producers allow you to access the current state by calling <code>getState</code>. You can optionally pass a selector function to <code>getState</code> to select a specific part of the state.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">// { count: 0 }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">// 0</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">--&gt; { count = 0 }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">--&gt; 0</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-1">Parameters<a href="#parameters-1" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><strong>optional</strong> <code>selector</code> - A function that selects a part of the state. If not provided, the entire state is returned.</li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-1">Returns<a href="#returns-1" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>getState</code> returns the current state of the producer, or the result of the <code>selector</code> if one is provided.</p><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="setstatenewstate"><code>setState(newState)</code><a href="#setstatenewstate" class="hash-link" aria-label="Direct link to setstatenewstate" title="Direct link to setstatenewstate">​</a></h3><p><code>setState</code> lets you manually update the state of the producer. It is generally recommended to use actions instead of <code>setState</code> to update state.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> count</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> count </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-2">Parameters<a href="#parameters-2" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><code>newState</code> - The new state of the producer.</li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-2">Returns<a href="#returns-2" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>setState</code> does not return anything.</p><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="resetstate"><code>resetState()</code><a href="#resetstate" class="hash-link" aria-label="Direct link to resetstate" title="Direct link to resetstate">​</a></h3><p><code>resetState</code> lets you reset the state of the producer to the initial value passed to <a href="/reflex/docs/reference/reflex/create-producer"><code>createProducer</code></a>. It&#x27;s useful for debugging and resetting state between tests.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">resetState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">resetState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-3">Returns<a href="#returns-3" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>resetState</code> does not return anything.</p><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="subscribeselector-predicate-listener"><code>subscribe(selector?, predicate?, listener)</code><a href="#subscribeselector-predicate-listener" class="hash-link" aria-label="Direct link to subscribeselector-predicate-listener" title="Direct link to subscribeselector-predicate-listener">​</a></h3><p>The <code>subscribe</code> method lets you listen for changes to the producer&#x27;s state. Generally, you should pass a selector function to <code>subscribe</code> to only listen for changes to a subset of the state.</p><p>To unsubscribe from a listener, call the function returned by <code>subscribe</code>.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectCount</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> unsubscribe </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">// 1, 0</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> unsubscribe </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">--&gt; 1, 0</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>You may optionally pass a predicate function to <code>subscribe</code> to only listen for changes that match a certain condition. If the predicate is provided, the listener will only be called if the predicate returns <code>true</code>.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectCount</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">isEven</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> count </span><span class="token operator" style="color:#D73A49">%</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">2</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isEven</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">// 2, 0</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">isEven</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> count </span><span class="token operator" style="color:#D73A49">%</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">2</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">==</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isEven</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">--&gt; 2, 0</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><a href="#running-side-effects">See more examples below.</a></p><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-3">Parameters<a href="#parameters-3" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><p><strong>optional</strong> <code>selector</code> - A function that selects a part of the state. If not provided, the entire state is passed to the listener.</p></li><li><p><strong>optional</strong> <code>predicate</code> - A function that determines whether the listener should be called. If not provided, the listener will always be called.</p></li><li><p><code>listener</code> - A function that is called when the state changes. The function receives the state as its first argument, and the previous state as its second argument.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-4">Returns<a href="#returns-4" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>subscribe</code> returns a function that can be called to unsubscribe the listener.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Caveats</div><div class="admonitionContent_Y2o7"><ul><li><p>If you pass a selector to <code>subscribe</code>, the listener will only be called once the selector returns a new value. Changes are compared <strong>by reference (<code>===</code>)</strong>, so if your selector creates a new object, remember to <a href="/reflex/docs/reference/reflex/create-selector">memoize it with <code>createSelector</code>.</a></p></li><li><p>State updates within a <code>subscribe</code> event should only be done in response to a selected state or under certain conditions. Otherwise, you may end up in an infinite loop.</p></li><li><p>Listeners are called synchronously <strong>on the frame after an action is dispatched</strong>. This means that if you dispatch multiple actions in the same frame, listeners will only be called once with the final state.</p></li><li><p>Similar to Redux, if you subscribe, unsubscribe, or change state while a listener is being called, the changes will not affect the current dispatch. However, they will affect the next dispatch.</p></li></ul></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="onceselector-predicate-listener"><code>once(selector, predicate?, listener)</code><a href="#onceselector-predicate-listener" class="hash-link" aria-label="Direct link to onceselector-predicate-listener" title="Direct link to onceselector-predicate-listener">​</a></h3><p><code>once</code> lets you listen for a single change to the producer&#x27;s state. It works similarly to <a href="#subscribeselector-predicate-listener"><code>subscribe</code></a>, but the listener is automatically unsubscribed after the first call. If the predicate is provided, the listener will only be called if the predicate returns <code>true</code>.</p><p>To unsubscribe from a listener, call the function returned by <code>once</code>.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectCounter</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">isGreaterThanOne</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> count </span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">once</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCounter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isGreaterThanOne</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;is greater than 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectCounter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">isGreaterThanOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> count </span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">once</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCounter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isGreaterThanOne</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;is greater than 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><a href="#waiting-for-state-changes">See more examples below.</a></p><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-4">Parameters<a href="#parameters-4" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><p><code>selector</code> - A function that selects a part of the state.</p></li><li><p><strong>optional</strong> <code>predicate</code> - A function that determines whether the listener should be called. If not provided, the listener will be called once the selected state changes.</p></li><li><p><code>listener</code> - A function that is called when the state changes. The function receives the new state as its first argument, and the state from the time of subscription as its second argument.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-5">Returns<a href="#returns-5" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>once</code> returns a function that can be called to unsubscribe the listener.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Caveats</div><div class="admonitionContent_Y2o7"><ul><li><p><code>once</code> has the <a href="#caveats">same caveats</a> as <a href="#subscribeselector-predicate-listener"><code>subscribe</code></a>.</p></li><li><p>If the predicate returns <code>true</code> at the time of subscription, the listener <strong>will not</strong> be called immediately. It will only be called once the selected state changes, and only if the predicate returns <code>true</code> at that time. This behavior is analogous to <code>Promise.fromEvent</code> and how it waits for the <em>next</em> event.</p></li></ul></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="waitselector-predicate"><code>wait(selector, predicate?)</code><a href="#waitselector-predicate" class="hash-link" aria-label="Direct link to waitselector-predicate" title="Direct link to waitselector-predicate">​</a></h3><p><code>wait</code> returns a promise that resolves once the selected state changes. If the predicate is provided, the promise will only resolve if the predicate returns <code>true</code>.</p><p>To unsubscribe from a listener, cancel the promise returned by <code>wait</code>.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectCounter</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">isGreaterThanOne</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> count </span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCounter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isGreaterThanOne</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;is greater than 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectCounter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">isGreaterThanOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> count </span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCounter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isGreaterThanOne</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">andThen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;is greater than 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><a href="#waiting-for-state-changes">See more examples below.</a></p><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-5">Parameters<a href="#parameters-5" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><p><code>selector</code> - A function that selects a part of the state.</p></li><li><p><strong>optional</strong> <code>predicate</code> - A function that determines whether the promise should resolve. If not provided, the promise will resolve once the selected state changes.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-6">Returns<a href="#returns-6" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>wait</code> returns a promise that resolves once the selected state changes <em>and</em> the predicate returns <code>true</code>.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Caveats</div><div class="admonitionContent_Y2o7"><ul><li><p><code>wait</code> has the <a href="#caveats">same caveats</a> as <a href="#subscribeselector-predicate-listener"><code>subscribe</code></a>.</p></li><li><p>If the predicate returns <code>true</code> at the time <code>wait</code> is called, the Promise <strong>will not</strong> resolve immediately. It will only be resolve once the selected state changes, and only if the predicate returns <code>true</code> at that time. This behavior is analogous to <code>Promise.fromEvent</code> and how it waits for the <em>next</em> event.</p></li></ul></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="observeselector-discriminator-observer"><code>observe(selector, discriminator?, observer)</code><a href="#observeselector-discriminator-observer" class="hash-link" aria-label="Direct link to observeselector-discriminator-observer" title="Direct link to observeselector-discriminator-observer">​</a></h3><p><code>observe</code> lets you track the addition and removal of a <strong>unique item</strong> in the producer&#x27;s state. The selector may return an array or a record of items. When an item is added, the Observer is called with the item and the index, and cleaned up when the item is removed.</p><p>The <strong>discriminator</strong> is used to differentiate between items. If the discriminator is not provided, the item is tracked by its reference in the record. If the discriminator is provided, the discriminator is called with the item and index and should return a value unique to that item. The item is tracked by this value instead.</p><p>To unsubscribe all Observers, call the function returned by <code>observe</code>.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectTodos</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">identifyTodo</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">Todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectTodos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> identifyTodo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;was added&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;was removed&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectTodos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">todos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">identifyTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectTodos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> identifyTodo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;was added&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;was removed&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><a href="#using-the-observer-pattern">See more examples below.</a></p><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-6">Parameters<a href="#parameters-6" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><p><code>selector</code> - A function that selects a part of the state.</p></li><li><p><strong>optional</strong> <code>discriminator</code> - A function that returns a unique identifier for an item. If not provided, the item is tracked by its reference in the record.</p></li><li><p><code>observer</code> - Called when an item is added to the record. It returns an optional cleanup function that is called when the item is removed from the state.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-7">Returns<a href="#returns-7" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>observe</code> returns a function that can be called to unsubscribe from the state and clean up all Observers.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Caveats</div><div class="admonitionContent_Y2o7"><ul><li><p><strong>Passing a discriminator is highly recommended when tracking unique objects.</strong> This is because immutable objects are compared by reference. If you pass a record of objects without a discriminator, the Observer will be called every time an object is updated.</p></li><li><p><strong>The discriminator must return a unique value for each item.</strong> If two items have the same discriminator, Observers will track the first to be added or removed.</p></li><li><p><strong>The Observer is called immediately for each item in the initial state.</strong> This means that if the state is already populated with items, the Observer will be called for each item.</p></li><li><p><strong>The first argument of the Observer is the item that was added.</strong> It acts as an initial state and <strong>does not update</strong> when the item is updated.</p></li></ul></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="observewhileselector-predicate-observer"><code>observeWhile(selector, predicate?, observer)</code><a href="#observewhileselector-predicate-observer" class="hash-link" aria-label="Direct link to observewhileselector-predicate-observer" title="Direct link to observewhileselector-predicate-observer">​</a></h3><p><code>observeWhile</code> is similar to <a href="#observeselector-discriminator-observer"><code>observe</code></a>, but it creates only one Observer over the time the selector returns a truthy value, and cleans it up when it becomes falsy. This is useful for tracking a specific value or condition in the state.</p><p>The <code>predicate</code> can be used if you want to specify a certain condition instead of evaluating the truthiness of the selected state. It is called with the current and previous selected state, and should return a boolean indicating whether the Observer should be created.</p><p>To unsubscribe the Observer, call the function returned by <code>observeWhile</code>.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectStatus</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">isLoading</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> status </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;loading&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">observeWhile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isLoading</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;loading started&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;loading ended&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">isLoading</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> status </span><span class="token operator" style="color:#D73A49">==</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;loading&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">observeWhile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isLoading</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;loading started&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;loading ended&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><a href="#using-the-observer-pattern">See more examples below.</a></p><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-7">Parameters<a href="#parameters-7" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><p><code>selector</code> - A function that selects a part of the state.</p></li><li><p><strong>optional</strong> <code>predicate</code> - A function that determines whether the Observer should be created. If not provided, the Observer is created when the selected state is truthy.</p></li><li><p><code>observer</code> - Called when the selector or predicate returns a truthy value. It returns an optional cleanup function that is called when the value is no longer truthy.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-8">Returns<a href="#returns-8" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>observeWhile</code> returns a function that can be called to unsubscribe from the state and clean up the Observer.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Caveats</div><div class="admonitionContent_Y2o7"><ul><li>Only one Observer can exist at one time, and it will not be called again until the selector or predicate returns a falsy value and then a truthy value again.</li></ul></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="flush"><code>flush()</code><a href="#flush" class="hash-link" aria-label="Direct link to flush" title="Direct link to flush">​</a></h3><p>The <code>flush</code> method is used to immediately run a scheduled update. This is useful for forcing an update to run synchronously, but should generally be avoided.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Caveats</div><div class="admonitionContent_Y2o7"><ul><li><code>flush</code> should not be called during a state update. Doing so might cause unexpected behavior.</li></ul></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="applymiddlewaremiddlewares"><code>applyMiddleware(...middlewares)</code><a href="#applymiddlewaremiddlewares" class="hash-link" aria-label="Direct link to applymiddlewaremiddlewares" title="Direct link to applymiddlewaremiddlewares">​</a></h3><p>The <code>applyMiddleware</code> method is used to apply middleware to the producer. Middleware can be used to enhance producers, dispatch actions, or perform side effects.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> loggerMiddleware</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#8250DF">ProducerMiddleware</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;initial state:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;next state:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dispatch</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#D73A49">...</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">dispatching </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">:</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#D73A49">...</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#D73A49">...</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">applyMiddleware</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loggerMiddleware</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> loggerMiddleware</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Reflex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Middleware </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;initial state:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;next state:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dispatch</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;dispatching&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">applyMiddleware</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loggerMiddleware</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><a href="#using-middleware">See more examples below.</a></p><h4 class="anchor anchorWithStickyNavbar_jD0q" id="parameters-8">Parameters<a href="#parameters-8" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4><ul><li><code>...middlewares</code> - A list of middleware functions. The middleware functions are called in the order they are provided.</li></ul><h4 class="anchor anchorWithStickyNavbar_jD0q" id="returns-9">Returns<a href="#returns-9" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4><p><code>applyMiddleware</code> returns the original producer.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Caveats</div><div class="admonitionContent_Y2o7"><ul><li><p>Middleware functions have <strong>three layers</strong> of abstraction: the producer, the dispatch function, and individual dispatches. The producer is the <strong>highest level of abstraction</strong> and is called once when applying the middleware. The dispatch function is the <strong>middle layer of abstraction</strong> and called with the dispatch functions in the producer. The individual dispatches are the <strong>lowest level of abstraction</strong> and run before each dispatch.</p></li><li><p><strong>Middleware functions are called in the order they are provided.</strong> This means that middleware functions that depend on other middleware functions should be provided after their dependencies.</p></li><li><p><strong>The return value matters!</strong> Middleware functions can intercept dispatches and make them return a value other than the new state. If a middleware function returns a value, the next middleware function will receive that value, and eventually will be returned by the dispatch function.</p></li></ul></div></div><hr><h2 class="anchor anchorWithStickyNavbar_jD0q" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h2><h3 class="anchor anchorWithStickyNavbar_jD0q" id="running-side-effects">Running side effects<a href="#running-side-effects" class="hash-link" aria-label="Direct link to Running side effects" title="Direct link to Running side effects">​</a></h3><p>Games have a lot of state that changes over time, and you often need to perform <em>side effects</em> for certain state updates. Let&#x27;s first look at how to subscribe to state changes, and then we&#x27;ll cover some use cases.</p><p>You can use <a href="#subscribeselector-predicate-listener"><code>subscribe</code></a> to connect a listener function that runs whenever a certain part of the state changes:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectCount</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;count changed:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">// count changed: 10</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#8250DF">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;count changed:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080;font-style:normal">--&gt; count changed: 10</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>The listener runs whenever the value given by <code>selectCount</code> changes. Once the <code>increment</code> action is dispatched, the listener will output the new value of <code>count</code> on the next tick.</p><p>You pass two parameters to the <code>subscribe</code> method:</p><ol><li>A <em>selector</em> that returns a subset of the state you want to subscribe to.</li><li>The <em>listener</em> to call when the state changes.</li></ol><p>Once you have subscribed to the state you want, you can safely run side effects in the listener function. For example, you play a damage sound when a player gets hurt.</p><p><strong>Say you have a game where the player&#x27;s health is stored in the state:</strong></p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:#116329">RootState</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">readonly</span><span class="token plain"> health</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> initialState</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> producer </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createProducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initialState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#8250DF">takeDamage</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> health</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#D73A49">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        health</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">health</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token plain"> health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">type RootState </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type RootActions </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    takeDamage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> initialState </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> producer </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createProducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initialState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    takeDamage </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> health</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> nextState </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nextState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">health </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> nextState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">::</span><span class="token plain"> Reflex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Producer</span><span class="token operator" style="color:#D73A49">&lt;</span><span class="token plain">RootState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RootActions</span><span class="token operator" style="color:#D73A49">&gt;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Your producer has an action to deal damage to the player, and a <code>health</code> field for the player in the state. You now know how to select the <code>health</code> field and subscribe to changes, but how can you play a sound when they <em>lose</em> health?</p><p><strong>You can do this by checking if the new health is lower than the previous health:</strong></p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectHealth</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">health</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectHealth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health </span><span class="token operator" style="color:#D73A49">&lt;</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">playDamageSound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectHealth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectHealth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> health </span><span class="token operator" style="color:#D73A49">&lt;</span><span class="token plain"> prevHealth </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">playDamageSound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><strong>This code calls the <code>playDamageSound</code> function whenever the player&#x27;s health decreases.</strong> If the current health is less than the previous health, the player was hurt, and the sound should play.</p><p>But what if you want to wait for a specific state change to occur? <a href="#waiting-for-state-changes">Producers provide methods for that, too!</a></p><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="waiting-for-state-changes">Waiting for state changes<a href="#waiting-for-state-changes" class="hash-link" aria-label="Direct link to Waiting for state changes" title="Direct link to Waiting for state changes">​</a></h3><p>Sometimes, you want to delay a side effect until a specific state change occurs. Producers offer the <a href="#onceselector-predicate-listener"><code>once</code></a> and <a href="#waitselector-predicate"><code>wait</code></a> methods to help wait for an event to occur.</p><p>For example, say your player state also contains a <code>jumping</code> boolean that is set to <code>true</code> when the player holds down the jump button. You want it to run a <code>jump()</code> function in a loop, and disconnect it when it stops. One way to automatically disconnect the loop is with <a href="#onceselector-predicate-listener"><code>once</code></a>.</p><p>This code starts the loop when <code>jumping</code> is set to <code>true</code>, and then disconnects the loop when the state changes to <code>false</code>:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectJumping</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jumping</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">isFalse</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> value </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> heartbeat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token maybe-class-name">RunService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Heartbeat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#8250DF">Connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jump</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">once</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isFalse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            heartbeat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#8250DF">Disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectJumping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jumping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">isFalse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> value </span><span class="token operator" style="color:#D73A49">==</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> jumping </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> heartbeat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> RunService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Heartbeat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">Connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jump</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">once</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isFalse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            heartbeat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">Disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><strong>The <a href="#onceselector-predicate-listener"><code>once</code></a> method receives three parameters:</strong></p><ol><li>A <code>selector</code> that returns the part of the state you want to subscribe to</li><li>An optional <code>predicate</code> that returns <code>true</code> when the state change you are waiting for has occurred</li><li>A <code>listener</code> that is called when the state has changed</li></ol><p>The <code>predicate</code> parameter is optional. If you pass a predicate, the listener will only be called when the predicate returns <code>true</code>. Otherwise, the listener will be called when the selector returns a new value.</p><p>Producers also provide <a href="#waitselector-predicate"><code>wait</code></a>, a shorthand for <a href="#onceselector-predicate-listener"><code>once</code></a> that returns a promise:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectJumping</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jumping</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">isFalse</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> value </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">startJumping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> heartbeat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token maybe-class-name">RunService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Heartbeat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#8250DF">Connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jump</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isFalse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#CF222E">finally</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        heartbeat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#8250DF">Disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">startJumping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectJumping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jumping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">isFalse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> value </span><span class="token operator" style="color:#D73A49">==</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">startJumping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> heartbeat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> RunService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Heartbeat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">Connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jump</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isFalse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">finally</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        heartbeat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">Disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectJumping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jumping</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> jumping </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">startJumping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="transforming-state-with-selectors">Transforming state with selectors<a href="#transforming-state-with-selectors" class="hash-link" aria-label="Direct link to Transforming state with selectors" title="Direct link to Transforming state with selectors">​</a></h3><p><strong>A good rule of thumb is to keep your state as simple as possible.</strong> This includes avoiding redundant data that can be derived from other parts of the state. However, that might make it harder to perform side effects on your existing state. How can you derive <em>new data</em> from the state without changing it?</p><p>Say your game&#x27;s state contains a list of players, and each player has a <code>health</code> and <code>id</code> property. If you want to retrieve a list of players that are alive, you can create a <em>selector</em> that creates a new list of players from the existing state:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectPlayers</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">players</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> selectAlivePlayers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">players</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> players</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">health</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectPlayers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">players</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> selectAlivePlayers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Reflex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">players</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> alivePlayers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">for</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> player </span><span class="token keyword" style="color:#CF222E">in</span><span class="token plain"> players </span><span class="token keyword" style="color:#CF222E">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">health </span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">0</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> alivePlayers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_Y2o7"><p><strong>Using <a href="/reflex/docs/reference/reflex/create-selector"><code>createSelector</code></a> for deriving new objects is good practice.</strong> It allows you to <strong>memoize</strong> a selector and cache its results. Note that this is best used when the selector <strong>returns a new object</strong> (mapping, filtering, etc.) or <strong>performs a heavy computation</strong>. A simple table index does not need to be memoized.</p><p><strong>This is because state changes are determined by reference equality (<code>===</code>).</strong> If Reflex calls your selector and it always returns a new table, Reflex will think that the state has changed <strong>every time</strong> the selector is called. This can lead to performance issues down the line.</p></div></div><p><strong>With this selector, you can subscribe to changes in the list of alive players.</strong> Your original state hasn&#x27;t changed, but you can now filter out the players that are alive and perform side effects based on that.</p><p>For example, you can run some code whenever a player is filtered from the list of alive players:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectAlivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevAlivePlayers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> player </span><span class="token keyword" style="color:#CF222E">of</span><span class="token plain"> prevAlivePlayers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> stillAlive </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> alivePlayers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#D73A49">!</span><span class="token plain">stillAlive</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#8250DF">playerDied</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">hasPlayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">players</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">for</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> player </span><span class="token keyword" style="color:#CF222E">in</span><span class="token plain"> players </span><span class="token keyword" style="color:#CF222E">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#D73A49">==</span><span class="token plain"> id </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectAlivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevAlivePlayers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">for</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> player </span><span class="token keyword" style="color:#CF222E">in</span><span class="token plain"> prevAlivePlayers </span><span class="token keyword" style="color:#CF222E">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">not</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">hasPlayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#8250DF">playerDied</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p><strong>But finding differences between lists can quickly get cumbersome.</strong> What if you want to track the health of a specific player? Or what if you want to clean up some state when a player dies?</p><p>This is where the <a href="#observeselector-discriminator-observer"><code>observe</code></a> method comes in handy. <a href="#using-the-observer-pattern">See how to use it in the next section.</a></p><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="using-the-observer-pattern">Using the observer pattern<a href="#using-the-observer-pattern" class="hash-link" aria-label="Direct link to Using the observer pattern" title="Direct link to Using the observer pattern">​</a></h3><p><strong>Game state often contains many lists and records of data.</strong> You will likely need to run code when a new item is added to a record, or clean something up when the item is removed. We&#x27;ll explore Observers, their use cases, and using <a href="#observeselector-discriminator-observer"><code>observe</code></a>.</p><p><strong>[]<code>observe</code>](#observeselector-discriminator-observer) brings the <a href="https://sleitnick.github.io/RbxObservers/docs/observer-pattern" target="_blank" rel="noopener noreferrer">Observer pattern</a> to Reflex.</strong> Some good use cases for <a href="#observeselector-discriminator-observer"><code>observe</code></a> include:</p><ul><li>Managing matches in a multiplayer game</li><li>Spawning players and cleaning up when they die or leave the game</li><li>Applying temporary status effects</li></ul><p>Let&#x27;s say your state has a list of players, and each player has a <code>health</code> and <code>id</code> property. You want to play a sound whenever a player is damaged or dies. To help track individual players, you should first create a <a href="#transforming-state-with-selectors">memoized selector</a> that selects a player&#x27;s health by their ID:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectPlayers</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">players</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectPlayerById</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">players</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> players</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">selectPlayerHealth</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#8250DF">selectPlayerById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> player</span><span class="token operator" style="color:#D73A49">?.</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#8250DF">selectPlayerHealth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#808080;font-style:normal">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectPlayers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">players</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectPlayerById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> Reflex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">players</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">for</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> player </span><span class="token keyword" style="color:#CF222E">in</span><span class="token plain"> players </span><span class="token keyword" style="color:#CF222E">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#D73A49">==</span><span class="token plain"> id </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> player</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">selectPlayerHealth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> Reflex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#8250DF">selectPlayerById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> player </span><span class="token keyword" style="color:#CF222E">and</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">health</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#8250DF">selectPlayerHealth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#005CC5">123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#808080;font-style:normal">-- ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_Y2o7"><p><strong><code>selectPlayerById</code> and <code>selectPlayerHealth</code> are <a href="/reflex/docs/reference/reflex/create-selector#selector-factories">selector factories</a>.</strong> Factories are useful when you want to create a reusable selector that is memoized for a specific set of inputs. <a href="/reflex/docs/reference/reflex/create-selector#passing-input-parameters">See more on why this approach helps with performance</a>.</p></div></div><p><strong>Now you can subscribe to changes in a specific player&#x27;s health!</strong> But creating this subscription for new players and unsubscribing when they are removed can be difficult to set up. This is where the <a href="#observeselector-discriminator-observer"><code>observe</code></a> method comes in handy.</p><p><a href="#observeselector-discriminator-observer"><code>observe</code></a> takes a <strong>selector</strong>, an optional <strong>discriminator</strong>, and an <strong>Observer</strong>. The selector returns a list or record of items, in which the Observer is called when a unique item is added. The Observer may return a cleanup function that is automatically called when the item is removed from the list.</p><p><strong>The Observer in this code exists throughout the lifetime of each player.</strong> It can subscribe to changes in the player&#x27;s health, and run side effects when the player is damaged or dies. When the player no longer alive, they are removed from the list, and the cleanup function is called.</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">discriminator</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">GamePlayer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectAlivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> discriminator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initialPlayer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> initialPlayer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> unsubscribe </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#8250DF">selectPlayerHealth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health </span><span class="token operator" style="color:#D73A49">&lt;</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#8250DF">playerDamaged</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">playerDied</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">discriminator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectAlivePlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> discriminator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initialPlayer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> id </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> initialPlayer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> unsubscribe </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#8250DF">selectPlayerHealth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevHealth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">if</span><span class="token plain"> health </span><span class="token operator" style="color:#D73A49">&lt;</span><span class="token plain"> prevHealth </span><span class="token keyword" style="color:#CF222E">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#8250DF">playerDamaged</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#8250DF">playerDied</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_pbkD"><div class="admonitionHeading_GpQE"><span class="admonitionIcon_QGX8"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_Y2o7"><p><strong>Remember to pass a discriminator function to <a href="#observeselector-discriminator-observer"><code>observe</code></a> if you&#x27;re observing objects!</strong> Because of the nature of immutable data, discriminators are necessary to ensure an Observer exists through the entire lifecycle of an object.</p></div></div><p><a href="#observeselector-discriminator-observer"><code>observe</code></a> receives three parameters:</p><ol><li>A <code>selector</code> that returns a list or record of entries.</li><li>An optional <code>discriminator</code> function that returns a unique identifier for each entry.</li><li>An <code>observer</code> function that is called when an entry is added, and returns a cleanup function that is called when the entry is removed.</li></ol><p>The discriminator is optional in the case that your list contains primitives like strings and numbers:</p><div class="tabs-container tabList_t2F_"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_TXTv tabs__item--active">TypeScript</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_TXTv">Luau</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_rlDe"><div class="language-ts codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-ts codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> selectPlayerIds </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">players</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> players</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">player</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayerIds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#808080;font-style:normal">// mounted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#808080;font-style:normal">// unmounted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_rlDe" hidden=""><div class="language-lua codeBlockContainer_qKi4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#ffffff"><div class="codeBlockContent_eGfQ"><pre tabindex="0" class="prism-code language-lua codeBlock_Id3g thin-scrollbar"><code class="codeBlockLines_UQKu"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> selectPlayerIds </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Reflex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#8250DF">createSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">players</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">local</span><span class="token plain"> ids </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">for</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> player </span><span class="token keyword" style="color:#CF222E">in</span><span class="token plain"> players </span><span class="token keyword" style="color:#CF222E">do</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        ids</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> player</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> ids</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#8250DF">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectPlayerIds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#808080;font-style:normal">-- mounted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#808080;font-style:normal">-- unmounted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_FwZQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zn7T" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Puu5"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_K6gp"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="using-middleware">Using middleware<a href="#using-middleware" class="hash-link" aria-label="Direct link to Using middleware" title="Direct link to Using middleware">​</a></h3><p><strong>Middleware is a powerful tool for extending the behavior of producers and actions.</strong> In Reflex, middleware can be used to add logging, cancel actions, add undo/redo functionality, and more.</p><p><a href="/reflex/docs/reference/reflex/middleware#building-middleware">See how to create middleware →</a></p><hr><h3 class="anchor anchorWithStickyNavbar_jD0q" id="using-multiple-producers">Using multiple producers<a href="#using-multiple-producers" class="hash-link" aria-label="Direct link to Using multiple producers" title="Direct link to Using multiple producers">​</a></h3><p><strong>Reflex is best used with a single producer holding the entire state of your app.</strong> It&#x27;s also good practice to organize state into different producers, and combine them with <a href="/reflex/docs/reference/reflex/combine-producers"><code>combineProducers</code></a>.</p><p><a href="/reflex/docs/reference/reflex/combine-producers">See <code>combineProducers</code> for more details →</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/reflex/docs/reference/reflex/create-producer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">createProducer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reflex/docs/reference/reflex/combine-producers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">combineProducers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_iSsM thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a><ul><li><a href="#action-functions" class="table-of-contents__link toc-highlight"><code>action</code> functions</a></li><li><a href="#getstateselector" class="table-of-contents__link toc-highlight"><code>getState(selector?)</code></a></li><li><a href="#setstatenewstate" class="table-of-contents__link toc-highlight"><code>setState(newState)</code></a></li><li><a href="#resetstate" class="table-of-contents__link toc-highlight"><code>resetState()</code></a></li><li><a href="#subscribeselector-predicate-listener" class="table-of-contents__link toc-highlight"><code>subscribe(selector?, predicate?, listener)</code></a></li><li><a href="#onceselector-predicate-listener" class="table-of-contents__link toc-highlight"><code>once(selector, predicate?, listener)</code></a></li><li><a href="#waitselector-predicate" class="table-of-contents__link toc-highlight"><code>wait(selector, predicate?)</code></a></li><li><a href="#observeselector-discriminator-observer" class="table-of-contents__link toc-highlight"><code>observe(selector, discriminator?, observer)</code></a></li><li><a href="#observewhileselector-predicate-observer" class="table-of-contents__link toc-highlight"><code>observeWhile(selector, predicate?, observer)</code></a></li><li><a href="#flush" class="table-of-contents__link toc-highlight"><code>flush()</code></a></li><li><a href="#applymiddlewaremiddlewares" class="table-of-contents__link toc-highlight"><code>applyMiddleware(...middlewares)</code></a></li></ul></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#running-side-effects" class="table-of-contents__link toc-highlight">Running side effects</a></li><li><a href="#waiting-for-state-changes" class="table-of-contents__link toc-highlight">Waiting for state changes</a></li><li><a href="#transforming-state-with-selectors" class="table-of-contents__link toc-highlight">Transforming state with selectors</a></li><li><a href="#using-the-observer-pattern" class="table-of-contents__link toc-highlight">Using the observer pattern</a></li><li><a href="#using-middleware" class="table-of-contents__link toc-highlight">Using middleware</a></li><li><a href="#using-multiple-producers" class="table-of-contents__link toc-highlight">Using multiple producers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/reflex/docs">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/reflex/docs/quick-start/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/reflex/docs/guides">Guides</a></li></ul></div><div class="col footer__col"><div class="footer__title">API Reference</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/reflex/docs/reference/reflex">Reflex API</a></li><li class="footer__item"><a class="footer__link-item" href="/reflex/docs/reference/roact-reflex">Roact Reflex API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.roblox-ts.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roblox-TS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_yhlY"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/Bcyh8kmRYe" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roblox OSS Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_yhlY"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/littensy/reflex" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_yhlY"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Richard L</div></div></div></footer></div>
<script src="/reflex/assets/js/runtime~main.d382dee3.js"></script>
<script src="/reflex/assets/js/main.edd3121e.js"></script>
</body>
</html>